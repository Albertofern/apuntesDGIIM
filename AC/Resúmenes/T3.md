# Arquitecturas TLP

Las arquitecturas con TLP(Thread Level Parallelism) son:

## Multiprocesador:
Varios threads en paralelo en varios procesadores.

Hay dos tipos:

1. Memoria centralizada (*UMA*: Uniform Memory Access), en el que todos los procesadores tienen acceso a toda la memoria mediante una red de interconexión.

2. Memoria distrubuida (*NUMA*: Non Uniform Memory Access), en el que cada procesador tiene su zona de memoria y se conectan mediante una red de interconexión.


## Multiprocesador en un chip:
Varios threads en un chip multicore.

En estos, puede ocurrir que todos los cores tengan cachés independientes y /todos/ tengan alguna en común, o que estén agrupados para que /ciertos/ de los cores tengan cachés comunes o que no tengan ninguna caché común y conecten directamente al conmutador.

## Core multithread:
Modifican su estructura ILP(Instruction level parallelism) para ejecutar threads en paralelo.

1. Los procesadores segmentados ejecutan instrucciones concurrentemente segmentando el uso de sus componentes.

2. Los procesadores VLIW(very large Instruction Word) y superescalares ejecutan instrucciones concurrentemente(segmentación) y en paralelo(emitiendo múltiples instrucciones a sus múltiples unidades funcionales).

Clasificación de cores multithread:

a. Temporal multithreading(TMT): Un core ejecuta varios threads, y la comuncación entre estas la controla el hardware, emitiendo instrucciones de un único thread por ciclo. A su vez, estos pueden ser:

    1. Fine-grain multithreading, la conmutación entre threads la hace el hardware sin coste, se hacen por turno rotatorio y por eventos de cierta latencia.

    2. Coarse-grain multithreading, la conmutación la decide el hardware con algún coste, tras intervalos de tiempo prefijados o por eventos de cierta latencia. Pueden ser estáticos, que tienen instrucciones explícitas para conmutar y cambio de coste bajo o dinámicos, que conmutan cuando hay fallos de caché o interrupciones.

b. Multihilo simultáneo(SMT): Se ejecutan en un core superescalar varios threads en paralelo, emitiendo instrucciones de varios threads en un ciclo.

# Coherencia del sistema de memoria

## Sistema de memoria en multiprocesadores

El sistema de memoria incluye cachés, memoria principal, controladores, buffers y comunicaciones entre estas componentes. Este sistema se encarga de comunicar los datos entre los procesadores.

## Coherencia en el S.M.

Los datos modificables pueden causar problemas con la E/S, los datos modificables compartidos pueden dar fallos de caché o lecturas de caché no actualizadas, y los privados si emigra el proceso dan también fallos de caché.

La memoria se puede actualizar de forma *inmediata*(write-through), cada vez que un procesador escribe en su caché lo hace también en memoria principal, lo cual no es muy rentable; o mediante *posescritura*(write-back), si se escribe todo el bloque cuando se desaloja de la caché.

Para intentar hacer la caché más coherente, se puede intentar hacer una *escritura con actualización*(write-update), en la que si un procesador escribe en una dirección de su caché, se escribe en las copias de esa dirección en las otras cachés, o una *escritura con invalidación*, en la que antes de modificar una dirección en su caché se invalidan las copias del bloque de la dirección en otras cachés.

### Requisitos del sistema para evitar problemas por incoherencia

1. Propagar las escrituras en una dirección, haciendo esta escritura visible a otros procesadores teniendo los componentes conectados por un bus. Ahora, si la red no fuera un bus, las actualizaciones se envían a todas las cachés y para mejorar la escalabilidad se envían las actualizaciones sólo a las cachés que tengan copia de ese bloque.

2. Serializar las escrituras en una dirección, viéndose en el mismo orden por todos los procesadores con los componentes conectados por un bus. Si la red no es un bus, el orden en el que las peticiones de escritura llegan al nodo que tiene en MP la dirección sirve para serializar en sistemas de comunicación que garantizan el orden de las transferencias.

El *directorio de memoria principal* está dentro de un nodo de cómputo y tiene un vector de bits con información sobre cachés con copia y un bit para el estado del bloque de memoria. Este se puede implementar de forma:

* Centralizada: Compartido por los nodos, contiene información de los bloques de todos los módulos de memoria.

* Distribuida: Las filas se distribuyen entre los nodos, y el directorio de cada nodo tiene información de los bloques de /sus/ módulos de memoria.

